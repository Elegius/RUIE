<!DOCTYPE html>
<html>
<head>
    <title>Auto-Detect Test</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        button { padding: 10px 20px; font-size: 16px; margin: 10px 0; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre { background: #f0f0f0; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>RUIE Auto-Detect Test</h1>
    
    <button onclick="testDetectAPI()">Test /api/detect-launcher</button>
    <button onclick="testDetectFunction()">Test detectLauncher() Function</button>
    <button onclick="clearLog()">Clear Log</button>
    
    <h2>Results:</h2>
    <div id="output"></div>
    
    <script>
    function log(message, type = 'info') {
        const output = document.getElementById('output');
        const div = document.createElement('div');
        div.className = type;
        div.textContent = message;
        output.appendChild(div);
        console.log(message);
    }
    
    function clearLog() {
        document.getElementById('output').innerHTML = '';
    }
    
    async function testDetectAPI() {
        log('Testing /api/detect-launcher...', 'info');
        try {
            const response = await fetch('/api/detect-launcher');
            log(`Response status: ${response.status} ${response.statusText}`, 'info');
            
            const data = await response.json();
            log(`Response OK: ${response.ok}`, 'info');
            log(`Success: ${data.success}`, data.success ? 'success' : 'error');
            
            if (data.launcher) {
                log(`asarPath: ${data.launcher.asarPath}`, 'success');
            } else if (data.error) {
                log(`Error: ${data.error}`, 'error');
            }
        } catch (error) {
            log(`EXCEPTION: ${error.message}`, 'error');
        }
    }
    
    async function testDetectFunction() {
        log('Testing detectLauncher() function...', 'info');
        
        // Create minimal DOM elements for the function
        if (!document.getElementById('asarPath')) {
            const input = document.createElement('input');
            input.id = 'asarPath';
            input.type = 'text';
            input.style.display = 'none';
            document.body.appendChild(input);
            log('Created asarPath input element', 'info');
        }
        
        if (!document.getElementById('init-status')) {
            const status = document.createElement('div');
            status.id = 'init-status';
            status.style.marginTop = '10px';
            status.style.padding = '10px';
            status.style.border = '1px solid #ccc';
            document.body.appendChild(status);
            log('Created init-status element', 'info');
        }
        
        // Now call the function if it exists
        if (typeof detectLauncher === 'function') {
            log('Calling detectLauncher()...', 'info');
            try {
                await detectLauncher();
                log('detectLauncher() completed', 'success');
            } catch (error) {
                log(`detectLauncher() threw: ${error.message}`, 'error');
            }
        } else {
            log('detectLauncher() function not found! App.js may not be loaded.', 'error');
        }
    }
    </script>
    
    <!-- Load the actual app.js to test -->
    <script src="app.js"></script>
</body>
</html>
